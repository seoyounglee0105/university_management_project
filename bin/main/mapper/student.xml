<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- student_tb용 쿼리 -->

<mapper namespace="com.green.university.repository.interfaces.StudentRepository">
	<insert id="insertToStudent">
		INSERT INTO student_tb (name, birth_date, gender, address, tel, dept_id, entrance_date, email)
		VALUES (#{name}, #{birthDate}, #{gender}, #{address}, #{tel}, #{deptId},
		#{entranceDate}, #{email})
	</insert>

	<select id="selectIdByCreateStudentDto" resultType="integer">
		SELECT id FROM student_tb
		WHERE name = #{name}
		AND birth_date = #{birthDate}
		AND gender = #{gender}
		AND address =#{address}
		AND tel = #{tel}
		AND
		dept_id = #{deptId}
		AND entrance_date = #{entranceDate}
		AND email = #{email}

	</select>

	<insert id="insertToUser">
		INSERT INTO user_tb
		VALUES (#{id}, #{password}, #{userRole})
	</insert>

	<select id="selectIdList" resultType="integer">
		SELECT id FROM student_tb;
	</select>

	<select id="selectByUserId" resultType="com.green.university.dto.response.UserInfoForUpdateDto">
		SELECT address, tel, email
		FROM student_tb
		WHERE id = #{userId}
	</select>

	<update id="updateStudent">
		UPDATE student_tb SET
		address = #{address}, tel = #{tel}, email = #{email}
		WHERE id = #{userId}
	</update>

	<select id="selectByStudentId" resultType="com.green.university.repository.model.Student">
		SELECT * FROM student_tb WHERE id = #{studentId}
	</select>

	<select id="selectStudentInfoById" resultType="com.green.university.dto.response.StudentInfoDto">
		SELECT s.id, s.name, s.birth_date, s.gender, s.address, s.tel, s.email, s.grade, s.semester, s.entrance_date, s.graduation_date, d.name AS dept_name, c.name AS college_name
		FROM student_tb AS s
		LEFT JOIN department_tb AS d
		ON s.dept_id = d.id
		LEFT JOIN college_tb AS c
		ON d.college_id = c.id
		WHERE s.id = #{id};
	</select>

</mapper>